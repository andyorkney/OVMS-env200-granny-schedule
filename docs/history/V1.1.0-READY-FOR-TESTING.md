# v1.1.0 Development Complete - Ready for Testing

## What I've Created

### 1. v1.1.0 Code
**File:** `charging-v1.1.0-WIP.js`

**Changes from v1.0.0:**
- Added cost calculation functions (170 lines of new code)
- Enhanced plug-in notifications with cost info
- Enhanced status display with cost estimates
- Shows overflow warnings when charging extends past window
- Shows savings vs standard rate

**What DID NOT change:**
- Zero changes to scheduling logic
- Zero changes to SOC targeting
- Zero changes to event handling
- All v1.0.0 functionality preserved

### 2. Testing Guide
**File:** `V1.1.0-CHANGES-AND-TESTING.md`

Complete testing plan including:
- Syntax and load testing
- Cost calculation verification
- Functional regression tests
- Overnight integration test
- Git workflow instructions

---

## How to Test v1.1.0

### Quick Test (5 minutes)

```bash
# 1. Upload to OVMS
scp charging-v1.1.0-WIP.js root@your-ovms:/store/scripts/lib/charging-test.js

# 2. SSH and test
ssh root@your-ovms
script eval 'require("lib/charging-test")'

# 3. Check status
script eval charging.status()
# Should show new "Cost Estimate:" section

# 4. Try with different SOC levels
# Lower SOC = more kWh = higher cost
```

### Full Test (Tonight)

```bash
# 1. Replace main file (backup first!)
cp /store/scripts/lib/charging.js /store/scripts/lib/charging-v1.0.0-backup.js
cp /store/scripts/lib/charging-test.js /store/scripts/lib/charging.js

# 2. Reload
script reload

# 3. Check status
script eval charging.status()
# Should show cost estimate

# 4. Plug in vehicle tonight
# Watch for enhanced notification with cost info

# 5. Verify charging behavior unchanged
# Still starts at 23:30
# Still stops at 85%
```

---

## Git Workflow When Ready

### After Testing Passes

```bash
# 1. On your computer (not OVMS), create feature branch
git checkout -b feature/v1.1.0-cost-awareness

# 2. Copy tested file to repo
cp charging-v1.1.0-WIP.js src/charging-v1.1.0.js

# 3. Update main charging.js
cp src/charging-v1.1.0.js src/charging.js

# 4. Stage files
git add src/charging-v1.1.0.js
git add src/charging.js

# 5. Commit
git commit -m "v1.1.0: Add cost awareness

Features:
- Cost calculations on plug-in
- Overflow warnings
- Enhanced status display
- Savings calculations

Testing:
- All v1.0.0 functionality verified unchanged
- Cost calculations verified accurate
- Overnight test passed

See docs/V1.1.0-CHANGES-AND-TESTING.md"

# 6. Push
git push origin feature/v1.1.0-cost-awareness

# 7. Create PR on GitHub (or merge directly if solo)

# 8. After merge, tag release
git checkout main
git pull
git tag -a v1.1.0 -m "v1.1.0: Cost awareness"
git push origin main --tags
```

---

## Example Cost Output

### Scenario 1: All in Window (Most Common)

```
Plugged in at 40%. Will charge to 85% during 23:30-05:30.
Need 15.3 kWh (~8.5h).
Est. cost: ¬£1.07 (saving ¬£3.40)
```

**Status command shows:**
```
Cost Estimate:
  Need: 15.3 kWh (~8.5h @ 1.8kW)
  Total cost: ¬£1.07
  ‚úÖ Will complete in cheap window
  Saving: ¬£3.40 vs standard rate
```

### Scenario 2: Overflow Warning

```
Plugged in at 30%. Will charge to 90% during 23:30-05:30.
Need 20.4 kWh (~11.3h).
Est. cost: ¬£3.45 ‚ö†Ô∏è
CHEAP: 10.8 kWh @ ¬£0.76
OVERFLOW: 9.6 kWh @ ¬£2.69
```

**Status command shows:**
```
Cost Estimate:
  Need: 20.4 kWh (~11.3h @ 1.8kW)
  Total cost: ¬£3.45
  ‚ö†Ô∏è WARNING: Will extend past window end
    Cheap: 10.8 kWh @ ¬£0.76
    Overflow: 9.6 kWh @ ¬£2.69
```

---

## Key Design Decision: Future-Proof for v1.2.0

The cost calculation function accepts **time ranges**:

```javascript
calculateCostForTimeRange(start_minutes, end_minutes, kwh_needed)
```

**v1.1.0 (now):** Always uses window start time
```javascript
var start = window_start_time; // Fixed: 23:30
```

**v1.2.0 (future):** Will use calculated optimal start
```javascript
var start = calculateOptimalStart(ready_by_time); // May be before 23:30
```

**Same cost function works for both!** No rewrite needed in v1.2.0 ‚úÖ

---

## Files Ready for Download

All in `/mnt/user-data/outputs/`:

1. **charging-v1.1.0-WIP.js** - The code (ready to test)
2. **V1.1.0-CHANGES-AND-TESTING.md** - Complete testing guide
3. **GITHUB-CLEANUP-PLAN.md** - Repo reorganization plan
4. **README-NEW.md** - New GitHub homepage
5. **USER-GUIDE.md** - User documentation
6. **DESIGN-v1.0.0.md** - Technical documentation
7. **FUTURE-ROADMAP.md** - Product roadmap

---

## What to Do Next

### Option A: Test Tonight
1. Upload v1.1.0-WIP.js to OVMS
2. Test tonight's charge cycle
3. If works well, commit to GitHub tomorrow

### Option B: Git First, Test Later
1. Follow GitHub cleanup plan
2. Commit v1.1.0 to feature branch
3. Test from there
4. Merge when confident

### Option C: Conservative Approach
1. Finish GitHub cleanup with v1.0.0 only
2. Get that stable and tagged
3. Then add v1.1.0 in separate PR

**My Recommendation:** Option A - Test tonight, Git tomorrow

---

## Risk Assessment

### Low Risk ‚úÖ
- No control logic changed
- Pure display/calculation code
- Easy to rollback to v1.0.0
- Worst case: Wrong cost numbers (but charging still works)

### What Could Go Wrong
1. **Cost calculations incorrect** ‚Üí User sees wrong estimates (but charging works fine)
2. **Syntax error** ‚Üí Script won't load (reload v1.0.0)
3. **Performance issue** ‚Üí Notifications slow (unlikely - simple math)

### Mitigation
- Test thoroughly before committing
- Keep v1.0.0 as backup
- Document any issues
- Fix and retest

---

## Success Criteria

v1.1.0 ready to commit when:

‚úÖ Loads without errors  
‚úÖ Status shows cost estimate  
‚úÖ Plug-in notification includes cost  
‚úÖ Overflow warnings appear when appropriate  
‚úÖ Cost calculations reasonable (within ¬±10% of manual calc)  
‚úÖ All v1.0.0 functionality still works  
‚úÖ Overnight test passes  

---

## Questions?

- **"What if costs are way off?"** ‚Üí Fix calculation, retest. Worst case: remove cost display, keep v1.0.0 charging logic
- **"What if it breaks v1.0.0?"** ‚Üí Rollback immediately, investigate
- **"Should I test on live or separate file?"** ‚Üí Test on separate file first (charging-test.js)
- **"When to commit?"** ‚Üí After successful overnight test

---

**Ready to test!** üöÄ

Let me know how testing goes, and I'll help with any issues or the GitHub workflow.
